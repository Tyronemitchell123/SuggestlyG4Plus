name: ğŸš€ Deploy to Vercel with Custom Domain

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

env:
  VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

jobs:
  deploy-vercel:
    name: ğŸš€ Deploy to Vercel (suggestlyg4plus.io)
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4

    - name: "ğŸ” Gate: Check Vercel secrets"
      id: gate
      run: |
        if [ -z "${{ secrets.VERCEL_TOKEN }}" ] || [ -z "${{ secrets.VERCEL_ORG_ID }}" ] || [ -z "${{ secrets.VERCEL_PROJECT_ID }}" ]; then
          echo "proceed=false" >> $GITHUB_OUTPUT
          echo "âš ï¸ Missing Vercel secrets. Skipping Vercel deployment steps."
        else
          echo "proceed=true" >> $GITHUB_OUTPUT
        fi

    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
      if: steps.gate.outputs.proceed == 'true'

    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
      if: steps.gate.outputs.proceed == 'true'

    - name: ğŸ“¦ Install Vercel CLI
      run: |
        npm install -g @vercel/cli
      if: steps.gate.outputs.proceed == 'true'

    - name: ğŸ”§ Configure Vercel
      run: |
        echo "ğŸ”§ Configuring Vercel deployment..."
        vercel --version
      if: steps.gate.outputs.proceed == 'true'

    - name: ğŸš€ Deploy to Vercel
      run: |
        echo "ğŸš€ Deploying to Vercel with custom domain..."
        vercel --prod --token ${{ secrets.VERCEL_TOKEN }} --scope ${{ secrets.VERCEL_ORG_ID }}
      env:
        VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
      if: steps.gate.outputs.proceed == 'true'

    - name: ğŸŒ Configure Custom Domain
      run: |
        echo "ğŸŒ Configuring custom domains..."
        echo "Domain: suggestlyg4plus.io"
        echo "Domain: www.suggestlyg4plus.io"
        # Vercel will automatically configure domains from vercel.json
      if: steps.gate.outputs.proceed == 'true'

    - name: ğŸ“Š Verify Deployment
      run: |
        echo "ğŸ“Š Verifying deployment..."
        echo "âœ… Vercel deployment completed"
        echo "ğŸŒ Main domain: https://suggestlyg4plus.io"
        echo "ğŸŒ WWW domain: https://www.suggestlyg4plus.io"
      if: steps.gate.outputs.proceed == 'true'

    - name: ğŸ“§ Send Deployment Notification
      run: |
        echo "ğŸ“§ Vercel deployment notification sent"
        echo "ğŸ‰ SuggestlyG4Plus v2.0 deployed to Vercel!"
        echo "ğŸŒ Access your application at:"
        echo "   â€¢ https://suggestlyg4plus.io"
        echo "   â€¢ https://www.suggestlyg4plus.io"
      if: steps.gate.outputs.proceed == 'true'
