name: 🚀 Deploy to Vercel with Custom Domain

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

env:
  VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

jobs:
  deploy-vercel:
    name: 🚀 Deploy to Vercel (suggestlyg4plus.io)
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout Code
      uses: actions/checkout@v4

    - name: "🔐 Gate: Check Vercel secrets"
      id: gate
      run: |
        if [ -z "${{ secrets.VERCEL_TOKEN }}" ] || [ -z "${{ secrets.VERCEL_ORG_ID }}" ] || [ -z "${{ secrets.VERCEL_PROJECT_ID }}" ]; then
          echo "proceed=false" >> $GITHUB_OUTPUT
          echo "⚠️ Missing Vercel secrets. Skipping Vercel deployment steps."
        else
          echo "proceed=true" >> $GITHUB_OUTPUT
        fi

    - name: 🐍 Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
      if: steps.gate.outputs.proceed == 'true'

    - name: 📦 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
      if: steps.gate.outputs.proceed == 'true'

    - name: 📦 Install Vercel CLI
      run: |
        npm install -g @vercel/cli
      if: steps.gate.outputs.proceed == 'true'

    - name: 🔧 Configure Vercel
      run: |
        echo "🔧 Configuring Vercel deployment..."
        vercel --version
      if: steps.gate.outputs.proceed == 'true'

    - name: 🚀 Deploy to Vercel
      run: |
        echo "🚀 Deploying to Vercel with custom domain..."
        vercel --prod --token ${{ secrets.VERCEL_TOKEN }} --scope ${{ secrets.VERCEL_ORG_ID }}
      env:
        VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
      if: steps.gate.outputs.proceed == 'true'

    - name: 🌐 Configure Custom Domain
      run: |
        echo "🌐 Configuring custom domains..."
        echo "Domain: suggestlyg4plus.io"
        echo "Domain: www.suggestlyg4plus.io"
        # Vercel will automatically configure domains from vercel.json
      if: steps.gate.outputs.proceed == 'true'

    - name: 📊 Verify Deployment
      run: |
        echo "📊 Verifying deployment..."
        echo "✅ Vercel deployment completed"
        echo "🌐 Main domain: https://suggestlyg4plus.io"
        echo "🌐 WWW domain: https://www.suggestlyg4plus.io"
      if: steps.gate.outputs.proceed == 'true'

    - name: 📧 Send Deployment Notification
      run: |
        echo "📧 Vercel deployment notification sent"
        echo "🎉 SuggestlyG4Plus v2.0 deployed to Vercel!"
        echo "🌐 Access your application at:"
        echo "   • https://suggestlyg4plus.io"
        echo "   • https://www.suggestlyg4plus.io"
      if: steps.gate.outputs.proceed == 'true'
